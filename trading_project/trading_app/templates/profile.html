<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Личный кабинет</title>
    <style>
        .hidden {
            display: none;
        }
        .profile-field, .edit-field {
            margin-bottom: 10px;
        }
        label {
            display: inline-block;
            width: 150px;
            text-align: right;
            margin-right: 10px;
        }
        input, select {
            width: 250px;
        }
        .form-container {
            margin: 20px 0;
        }
        .error {
            color: red;
        }
    </style>
    <script>
        function toggleEdit() {
            var profileFields = document.querySelectorAll('.profile-field');
            var editFields = document.querySelectorAll('.edit-field');
            var editButton = document.getElementById('edit-button');
            var saveButton = document.getElementById('save-button');

            profileFields.forEach(function(field) {
                field.classList.toggle('hidden');
            });

            editFields.forEach(function(field) {
                field.classList.toggle('hidden');
            });

            editButton.classList.toggle('hidden');
            saveButton.classList.toggle('hidden');
        }
    </script>
</head>
<body>

    <h1>Личный кабинет</h1>

    <!-- Вывод сообщений об ошибках и успешных действиях -->
    {% if messages %}
    <ul>
        {% for message in messages %}
        <li class="error">{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    <!-- ID пользователя -->
    <p><strong>ID пользователя:</strong> {{ user.id }}</p>

    <form method="post">
        {% csrf_token %}
        <div class="form-container">
            <!-- Имя -->
            <div>
                <label for="first_name">Имя:</label>
                <span class="profile-field">{{ user.userprofile.first_name }}</span>
                <input id="first_name" class="edit-field hidden" type="text" name="first_name" value="{{ user.userprofile.first_name }}">
            </div>

            <!-- Фамилия -->
            <div>
                <label for="last_name">Фамилия:</label>
                <span class="profile-field">{{ user.userprofile.last_name }}</span>
                <input id="last_name" class="edit-field hidden" type="text" name="last_name" value="{{ user.userprofile.last_name }}">
            </div>

            <!-- Email -->
            <div>
                <label for="email">Email:</label>
                <span class="profile-field">{{ user.userprofile.email }}</span>
                <input id="email" class="edit-field hidden" type="email" name="email" value="{{ user.userprofile.email }}">
            </div>

            <!-- Телефон -->
            <div>
                <label for="phone_number">Телефон:</label>
                <span class="profile-field">{{ user.userprofile.phone_number|default:"Не указан" }}</span>
                <input id="phone_number" class="edit-field hidden" type="text" name="phone_number" value="{{ user.userprofile.phone_number }}">
            </div>

            <!-- Дата рождения -->
            <div>
                <label for="birth_date">Дата рождения:</label>
                <span class="profile-field">{{ user.userprofile.birth_date|date:"d.m.Y" }}</span>
                <input id="birth_date" class="edit-field hidden" type="date" name="birth_date" value="{{ user.userprofile.birth_date|date:"Y-m-d" }}">
            </div>

            <!-- Пол -->
            <div>
                <label for="gender">Пол:</label>
                <span class="profile-field">{{ user.userprofile.get_gender_display }}</span>
                <select id="gender" class="edit-field hidden" name="gender">
                    <option value="M" {% if user.userprofile.gender == 'M' %}selected{% endif %}>Мужчина</option>
                    <option value="F" {% if user.userprofile.gender == 'F' %}selected{% endif %}>Женщина</option>
                </select>
            </div>

            <!-- Отчество -->
            <div>
                <label for="middle_name">Отчество:</label>
                <span class="profile-field">{{ user.userprofile.useradditionalinfo.middle_name|default:"Не указано" }}</span>
                <input id="middle_name" class="edit-field hidden" type="text" name="middle_name" value="{{ user.userprofile.useradditionalinfo.middle_name }}">
            </div>

            <!-- Никнейм -->
            <div>
                <label for="nickname">Никнейм:</label>
                <span class="profile-field">{{ user.userprofile.useradditionalinfo.nickname|default:"Не указан" }}</span>
                <input id="nickname" class="edit-field hidden" type="text" name="nickname" value="{{ user.userprofile.useradditionalinfo.nickname }}">
            </div>

            <!-- Страна -->
            <div>
                <label for="country">Страна:</label>
                <span class="profile-field">{{ user.userprofile.useradditionalinfo.country|default:"Не указана" }}</span>
                <input id="country" class="edit-field hidden" type="text" name="country" value="{{ user.userprofile.useradditionalinfo.country }}">
            </div>

            <!-- Город -->
            <div>
                <label for="city">Город:</label>
                <span class="profile-field">{{ user.userprofile.useradditionalinfo.city|default:"Не указан" }}</span>
                <input id="city" class="edit-field hidden" type="text" name="city" value="{{ user.userprofile.useradditionalinfo.city }}">
            </div>

            <!-- Telegram -->
            <div>
                <label for="telegram">Telegram:</label>
                <span class="profile-field">{{ user.userprofile.useradditionalinfo.telegram|default:"Не указан" }}</span>
                <input id="telegram" class="edit-field hidden" type="text" name="telegram" value="{{ user.userprofile.useradditionalinfo.telegram }}">
            </div>
        </div>

        <!-- Кнопки редактирования и сохранения -->
        <button id="edit-button" type="button" onclick="toggleEdit()">Редактировать данные</button>
        <button id="save-button" class="hidden" type="submit">Сохранить изменения</button>
    </form>

    <!-- Кнопка для изменения пароля -->
    <form method="get" action="{% url 'password_change' %}">
        <button type="submit">Изменить пароль</button>
    </form>

    <!-- Кнопка для выхода из аккаунта -->
    <form method="post" action="{% url 'logout' %}">
        {% csrf_token %}
        <button type="submit">Выйти</button>
    </form>
    <form method="post" action="{% url 'delete_account' %}">
        {% csrf_token %}
        <button type="submit">Удалить аккаунт</button>
    </form>

</body>
</html>

{% extends 'base.html' %}

{% block content %}
<h1>Загрузка данных для обучения</h1>

<!-- Отображение сообщений -->
{% if messages %}
<ul>
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}

<form method="post">
    {% csrf_token %}

    <!-- Выбор торговой пары -->
    <label for="pair">Выберите торговую пару:</label>
    <select id="pair" name="pair">
        {% for pair in symbols %}
            <option value="{{ pair }}">{{ pair }}</option>
        {% endfor %}
    </select>

    <!-- Выбор таймфрейма -->
    <label for="timeframe">Выберите тайм-фрейм:</label>
    <select id="timeframe" name="timeframe">
        {% for key, value in timeframes.items %}
            <option value="{{ key }}">{{ value }}</option>
        {% endfor %}
    </select>

    <!-- Выбор диапазона дат -->
    <label for="start_date">Начальная дата:</label>
    <input type="date" id="start_date" name="start_date" value="2020-01-01">

    <label for="end_date">Конечная дата:</label>
    <input type="date" id="end_date" name="end_date" value="{{ today }}">

    <!-- Кнопка загрузки данных -->
    <button type="submit">Загрузить данные</button>
</form>

<h2>Ваши загруженные данные</h2>

{% if user_data %}
    <ul>
        {% for data in user_data %}
            <li>
                <strong>{{ data.asset_name }}</strong> ({{ data.timestamp|date:"d.m.Y H:i" }})
                <!-- Форма для изменения названия таблицы -->
                <form method="post" action="{% url 'rename_table' data.id %}" style="display: inline;">
                    {% csrf_token %}
                    <input type="text" name="new_name" placeholder="Новое название">
                    <button type="submit">Изменить название</button>
                </form>
                <!-- Форма для удаления таблицы -->
                <form method="post" action="{% url 'delete_table' data.id %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit">Удалить</button>
                </form>
                <!-- Ссылка для просмотра таблицы -->
                <form method="get" action="{% url 'view_table' data.id %}" style="display: inline;">
                    <button type="submit">Посмотреть</button>
                </form>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>Нет загруженных данных</p>
{% endif %}
{% endblock %}
